@model IEnumerable<MentalHealthApp.Models.MoodEntry>

<link href="~/css/site.css" rel="stylesheet" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">


@if (!(bool)ViewData["HasAnyEntries"])
{
    <div class="alert alert-info text-center mt-4">
        You haven’t written any entries yet.<br />
        <a asp-action="Create" class="btn btn-purple">➕ WRITE Your First!</a>
    </div>
}
else if (!Model.Any())
{
    <div class="alert alert-warning text-center mt-4">
        No entries match the selected mood filter.
    </div>

    <div class=" justify-content-center d-flex">  <!--Centered Button-->
    <a href="javascript:history.back()" class="btn btn-primary">
        <i class="bi bi-arrow-left"></i> Go Back
    </a>   <!-- Back button-->
        </div>

}
else
{
    @if (ViewData["ShowCheckInReminder"] as bool? == true)
    {
        <div class="alert text-center" style="background-color:#f3e5ff; color:#6b44b3;">
            You haven't checked in recently!
        </div>
    }

    <div class="d-flex justify-content-center mb-3 gap-2">
    <form asp-action="Index" method="get" class="d-flex align-items-center gap-2">
        <label for="moodFilter">Filter by Mood:</label>
        <select name="moodFilter" id="moodFilter" class="form-select" onchange="this.form.submit()">
            <option value="">All</option>
            @foreach (var mood in Enum.GetValues(typeof(MoodType)))
{
    var isSelected = ViewData["CurrentMoodFilter"] != null && (MoodType)ViewData["CurrentMoodFilter"] == (MoodType)mood ? "selected" : "";
    <option value="@mood" isSelected>@mood</option>
}

        </select>
    </form>
</div>


    <h1 class="text-center tracking-in-expand" style="color:#6b44b3;">
        Your Mood Entries
    </h1>

    <div class="container mt-4">
        <a asp-controller="MoodEntries" asp-action="Create"
           class="btn btn-create"
           title="Click to Create!"
           style="border-radius: 100%; font-size: 90px; width: 120px; height: 120px; display: flex; justify-content: center; align-items: center; text-decoration: none; background-color:#6b44b3; color:white;">
            +
        </a>
    </div>


    <div class="d-flex justify-content-center gap-3 mt-3">
        <a asp-controller="MoodEntries" asp-action="MoodChart" class="btn btn-purple">
            <b>Your Mood Chart</b>
        </a>

        <a asp-controller="MoodEntries" asp-action="Stats" class="btn btn-purple">
            <b>Your Stats</b>
        </a>
        <a asp-controller="MoodEntries" asp-action="ExportToday" class="btn btn-purple" data-toggle="modal" data-target="#exampleModal">
            <b>Export Your Mood Entries</b>
        </a>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                The download should start shortly...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    @if (TempData["SuccessToast"] != null)
    {
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div class="toast show text-white shadow" style="background-color:#6b44b3;" role="alert">
                <div class="d-flex">
                    <div class="toast-body">
                        @TempData["SuccessToast"]
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            </div>
        </div>
    }

    <table class="table purple-table mt-4">
        <thead>
            <tr>
                <th>@Html.DisplayNameFor(m => m.First().Mood)</th>
                <th>@Html.DisplayNameFor(m => m.First().Date)</th>
                <th>@Html.DisplayNameFor(m => m.First().Notes)</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>@item.Mood</td>
                    <td>@Html.DisplayFor(modelItem => item.Date)</td>
                    <td>@Html.DisplayFor(modelItem => item.Notes)</td>
                    <td>
                        <!-- Edit button -->
                        <a asp-action="Edit" asp-route-id="@item.Id" class=" action-icon" title="Edit" style="text-decoration:none;fill: #6b44b3;">
                            <i class="bi bi-pencil-fill"></i>
                        </a>

                        <a asp-action="Delete" asp-route-id="@item.Id" class="action-icon" title="Delete"
                           style="text-decoration:none; fill: #6b44b3;"
                           data-bs-toggle="modal" data-bs-target="#deleteConfirmModal-@item.Id">
                            <i class="bi bi-trash-fill"></i>
                        </a>
                        <!-- Modal for each item -->
                        <div class="modal fade" id="deleteConfirmModal-@item.Id" tabindex="-1" aria-labelledby="deleteConfirmModalLabel-@item.Id" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content" style="color:#6b44b3;">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="deleteConfirmModalLabel-@item.Id">Confirm Delete</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        Are you sure you want to delete this entry?
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <form asp-action="Delete" asp-route-id="@item.Id" method="post" style="display:inline;">
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="action-icon btn btn-link p-0" title="Delete" style="color:#6b44b3;">
                                                <i class="bi bi-trash-fill"></i>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <a asp-action="Details" asp-route-id="@item.Id" class="action-icon" title="View Details" style="text-decoration:none; color: #6b44b3;">
                            <i class="bi bi-eye-fill"></i>
                        </a>
                    </td>

                </tr>
            }
        </tbody>
    </table>
}

<style>
    .tracking-in-expand {
        -webkit-animation: tracking-in-expand 0.7s cubic-bezier(0.215,0.610,0.355,1.000) both;
        animation: tracking-in-expand 0.7s 2s cubic-bezier(0.215,0.610,0.355,1.000) both;
        color:#6b44b3;
    }

    @@-webkit-keyframes tracking-in-expand {
        0% { letter-spacing: -0.5em; opacity: 0; }
        40% { opacity: 0.6; }
        100% { opacity: 1; }
    }

    @@keyframes tracking-in-expand {
        0% { letter-spacing: -0.5em; opacity: 0; }
        40% { opacity: 0.6; }
        100% { opacity: 1; }
    }

    table tbody tr:hover {
        background-color: #f3e5ff;
    }


    .action-icon {
        color: #6b44b3 !important; /* purple visible on white */
        font-size: 1.2rem;
        text-decoration: none;
    }

        .action-icon:hover {
            color: #4a2c82 !important; /* darker purple on hover */
        }



</style>
